<!DOCTYPE html>
<html>
<head>
    <title>Personal Expense Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

<div class="container my-4">
    <h1 class="text-center">ðŸ’° Personal Expense Tracker</h1>

    <!-- Add Expense Form -->
    <div class="card p-3 mb-4">
        <h5>Add New Expense</h5>
        <div class="row g-2">
            <div class="col-md-3"><input type="date" id="date" class="form-control"></div>
            <div class="col-md-3"><input type="text" id="category" class="form-control" placeholder="Category"></div>
            <div class="col-md-3"><input type="text" id="description" class="form-control" placeholder="Description"></div>
            <div class="col-md-2"><input type="number" id="amount" class="form-control" placeholder="Amount"></div>
            <div class="col-md-1"><button class="btn btn-success w-100" onclick="addExpense()">Add</button></div>
        </div>
    </div>

    <!-- Expenses Table -->
    <div class="card p-3 mb-4">
        <h5>All Expenses</h5>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Date</th><th>Category</th><th>Description</th><th>Amount</th>
                </tr>
            </thead>
            <tbody id="expenseTable"></tbody>
        </table>
    </div>

    <!-- Monthly Summary Chart -->
    <div class="card p-3">
        <h5>Monthly Summary</h5>
        <input type="month" id="monthSelect" class="form-control mb-3" onchange="loadSummary()">
        <canvas id="summaryChart" height="50" style="max-width:400px;max-height:350px;width:100%;height:auto;display:block;margin:auto;"></canvas>
    </div>
</div>

<script>
async function addExpense() {
    let data = {
        date: document.getElementById("date").value,
        category: document.getElementById("category").value,
        description: document.getElementById("description").value,
        amount: parseFloat(document.getElementById("amount").value)
    };

    let res = await fetch("/add", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
    });

    if (res.ok) {
        alert("Expense Added!");
        loadExpenses();
    }
}

async function loadExpenses() {
    let res = await fetch("/expenses");
    let expenses = await res.json();

    let table = document.getElementById("expenseTable");
    table.innerHTML = "";
    expenses.forEach(e => {
        table.innerHTML += `<tr>
            <td>${e.date}</td>
            <td>${e.category}</td>
            <td>${e.description}</td>
            <td>â‚¹${e.amount.toFixed(2)}</td>
        </tr>`;
    });
}

let chart;
async function loadSummary() {
    let month = document.getElementById("monthSelect").value;
    if (!month) return;

    let res = await fetch(`/summary/${month}`);
    let summary = await res.json();

    let labels = summary.map(s => s.category);
    let data = summary.map(s => s.total);

    if (chart) chart.destroy();
    chart = new Chart(document.getElementById("summaryChart"), {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: ['#FF6384','#36A2EB','#FFCE56','#8E44AD','#2ECC71']
            }]
        }
    });
}

window.onload = loadExpenses;
</script>

</body>
</html>
